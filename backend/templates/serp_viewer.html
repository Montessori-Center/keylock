<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SERP –ê–Ω–∞–ª–∏–∑ - –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #4285f4;
            padding-bottom: 10px;
        }
        .log-item {
            border: 1px solid #ddd;
            margin: 10px 0;
            padding: 15px;
            border-radius: 5px;
            background: #fafafa;
        }
        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .keyword {
            font-weight: bold;
            font-size: 18px;
            color: #1a73e8;
        }
        .date {
            color: #666;
            font-size: 14px;
        }
        .stats {
            display: flex;
            gap: 20px;
            margin: 10px 0;
        }
        .stat {
            background: #e8f0fe;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 14px;
        }
        .flags {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        .flag {
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: 500;
        }
        .flag.yes {
            background: #d4edda;
            color: #155724;
        }
        .flag.no {
            background: #f8d7da;
            color: #721c24;
        }
        .organic-list {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #ddd;
        }
        .organic-item {
            margin: 8px 0;
            padding: 8px;
            background: white;
            border-left: 3px solid #4285f4;
        }
        .position {
            display: inline-block;
            background: #4285f4;
            color: white;
            padding: 2px 8px;
            border-radius: 3px;
            margin-right: 10px;
            font-size: 12px;
        }
        .domain {
            font-weight: bold;
            color: #0d6efd;
        }
        .our-site {
            background: #28a745;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            margin-left: 10px;
            font-size: 11px;
        }
        .school-site {
            background: #ffc107;
            color: #333;
            padding: 2px 6px;
            border-radius: 3px;
            margin-left: 10px;
            font-size: 11px;
        }
        .intent {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin: 10px 0;
        }
        .intent.commercial {
            background: #28a745;
            color: white;
        }
        .intent.informational {
            background: #17a2b8;
            color: white;
        }
        .refresh-btn {
            background: #4285f4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .refresh-btn:hover {
            background: #357ae8;
        }
        .no-data {
            text-align: center;
            padding: 40px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç SERP –ê–Ω–∞–ª–∏–∑ - –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ª–æ–≥–æ–≤</h1>
        
        <div style="text-align: right; margin-bottom: 20px;">
            <button class="refresh-btn" onclick="loadLogs()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
        </div>
        
        <div id="logs-container">
            <div class="no-data">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const API_URL = '/api/dataforseo';
        const OUR_DOMAIN = 'montessori.ua';  // –£–∫–∞–∂–∏—Ç–µ –≤–∞—à –¥–æ–º–µ–Ω
        const SCHOOL_DOMAINS = ['jam.ua', 'artschool.com.ua', 'music-academy.kiev.ua', 'voiceschool.com.ua', 'guitar-school.kiev.ua'];
        
        async function loadLogs() {
            try {
                const response = await fetch(`${API_URL}/serp-logs?limit=20`);
                const data = await response.json();
                
                if (data.success) {
                    displayLogs(data.logs);
                } else {
                    document.getElementById('logs-container').innerHTML = '<div class="no-data">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</div>';
                }
            } catch (error) {
                console.error('Error loading logs:', error);
                document.getElementById('logs-container').innerHTML = '<div class="no-data">–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É</div>';
            }
        }
        
        function displayLogs(logs) {
            const container = document.getElementById('logs-container');
            
            if (!logs || logs.length === 0) {
                container.innerHTML = '<div class="no-data">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö SERP –∞–Ω–∞–ª–∏–∑–∞. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∞–Ω–∞–ª–∏–∑ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤.</div>';
                return;
            }
            
            let html = '';
            
            logs.forEach(log => {
                const isCommercial = log.intent === '–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π';
                
                html += `
                    <div class="log-item">
                        <div class="log-header">
                            <span class="keyword">${log.keyword || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ'}</span>
                            <span class="date">${new Date(log.created_at).toLocaleString('ru-RU')}</span>
                        </div>
                        
                        <div class="stats">
                            <span class="stat">üìä –í—Å–µ–≥–æ: ${log.summary.total_items}</span>
                            <span class="stat">üåê –û—Ä–≥–∞–Ω–∏–∫–∞: ${log.summary.organic}</span>
                            <span class="stat">üí∞ –†–µ–∫–ª–∞–º–∞: ${log.summary.paid}</span>
                            <span class="stat">üó∫Ô∏è –ö–∞—Ä—Ç—ã: ${log.summary.maps}</span>
                            <span class="stat">üíµ –°—Ç–æ–∏–º–æ—Å—Ç—å: $${log.cost.toFixed(4)}</span>
                        </div>
                        
                        <div class="flags">
                            <span class="flag ${log.flags.has_ads ? 'yes' : 'no'}">
                                –†–µ–∫–ª–∞–º–∞: ${log.flags.has_ads ? '–î–ê' : '–ù–ï–¢'}
                            </span>
                            <span class="flag ${log.flags.has_maps ? 'yes' : 'no'}">
                                –ö–∞—Ä—Ç—ã: ${log.flags.has_maps ? '–î–ê' : '–ù–ï–¢'}
                            </span>
                            <span class="flag ${log.flags.has_our_site ? 'yes' : 'no'}">
                                –ù–∞—à —Å–∞–π—Ç: ${log.flags.has_our_site ? '–î–ê' : '–ù–ï–¢'}
                            </span>
                            <span class="flag ${log.flags.has_school_sites ? 'yes' : 'no'}">
                                –®–∫–æ–ª—ã: ${log.flags.has_school_sites ? '–î–ê' : '–ù–ï–¢'}
                                ${log.school_percentage > 0 ? `(${log.school_percentage.toFixed(1)}%)` : ''}
                            </span>
                        </div>
                        
                        <div class="intent ${isCommercial ? 'commercial' : 'informational'}">
                            –ò–Ω—Ç–µ–Ω—Ç: ${log.intent}
                        </div>
                        
                        ${displayOrganicResults(log.parsed_items.organic)}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function displayOrganicResults(organic) {
            if (!organic || organic.length === 0) {
                return '<div class="organic-list"><em>–û—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</em></div>';
            }
            
            let html = '<div class="organic-list"><strong>–û—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∞—è –≤—ã–¥–∞—á–∞:</strong>';
            
            organic.forEach(item => {
                const isOurSite = item.domain === OUR_DOMAIN || item.domain.includes(OUR_DOMAIN);
                const isSchoolSite = SCHOOL_DOMAINS.some(school => item.domain.includes(school));
                
                html += `
                    <div class="organic-item">
                        <span class="position">#${item.position}</span>
                        <span class="domain">${item.domain}</span>
                        ${isOurSite ? '<span class="our-site">–ù–ê–® –°–ê–ô–¢</span>' : ''}
                        ${isSchoolSite ? '<span class="school-site">–®–ö–û–õ–ê</span>' : ''}
                        <div style="font-size: 12px; color: #666; margin-top: 5px;">
                            ${item.title}
                        </div>
                        <div style="font-size: 11px; color: #999;">
                            ${item.url.substring(0, 80)}${item.url.length > 80 ? '...' : ''}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            return html;
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –ª–æ–≥–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        loadLogs();
        
        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        setInterval(loadLogs, 30000);
    </script>
</body>
</html>